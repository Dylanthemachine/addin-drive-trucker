"use strict";geotab.addin.driveTrucker=function(){var l,o,r,i,c,a,u,s,p,n={},m=new AbortController,f=[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}],d=function(e,t){return{lat:e,lng:t}},y=function(e){console.error(e),20!==e.code&&(l.loading=!1)},g=function(e,t){return m.abort(),m=new AbortController,l.loading=!0,fetch("".concat("https://us-central1-geotab-demo-project.cloudfunctions.net","/truckParkingLocation?latitude=").concat(e.lat,"&longitude=").concat(e.lng,"&radius=").concat(t,"&limit=1000"),{signal:m.signal}).then(function(e){return e.json()}).then(function(e){e.forEach(function(e){n["".concat(e.Lat,"x").concat(e.Lon)]={center:d(e.Lat,e.Lon)}}),l.parkingLocations=Object.values(n),l.loading=!1}).catch(y)},h=function(t){l.$refs.mapRef.$mapPromise.then(function(e){e.setOptions({styles:t?f:[]})})};return{initialize:function(e,t,n){i=e,o=document.getElementById("driveTrucker"),Vue.use(VueGoogleMaps,{load:{key:"",libraries:"places"}}),Vue.component("gmap-cluster",VueGoogleMaps.Cluster),l=new Vue({el:"#driveTrucker",data:function(){return{loading:!0,center:d(0,0),marker:d(0,0),zoom:10,mapOptions:{styles:[],mapType:"roadmap",disableDefaultUI:!0,gestureHandling:"greedy"},radius:200,parkingLocations:[],selected:{},directions:[],polylineOuterOptions:{strokeColor:"#FFFFFF",strokeOpacity:1,strokeWeight:6},polylineInnerOptions:{strokeColor:"#1976d2",strokeOpacity:1,strokeWeight:4},infoContent:{distance:{},duration:{}},infoWindowPos:null,infoWinOpen:!1,currentMidx:null,infoOptions:{pixelOffset:{width:0,height:-35}}}},methods:{navigate:function(e){e.preventDefault();var t=l.marker.lat,n=l.marker.lng,o=l.selected.center.lat,r=l.selected.center.lng,a="";i.mobile.exists()?a=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?"maps://?q=".concat(o,",").concat(r):"geo:".concat(t,",").concat(n,"?q=").concat(o,",").concat(r):a="https://maps.google.com/maps?saddr=".concat(t,",").concat(n,"&daddr=").concat(o,",").concat(r);window.open(a,"_system")},zoomChange:function(e){l.zoom=e},centerChanged:function(e){clearTimeout(a),a=setTimeout(function(){l.center=d(e.lat(),e.lng())},1e3)},zoomMapTo:function(e,t,n){n.preventDefault(),l.zoom=t,l.center=e},toggleSatelite:function(){"roadmap"===l.mapOptions.mapType?l.mapOptions.mapType="satellite":l.mapOptions.mapType="roadmap",l.$refs.mapRef.$mapPromise.then(function(e){e.setMapTypeId(l.mapOptions.mapType)})},boundsChanged:function(){l.$refs.mapRef.$mapPromise.then(function(e){var t=e.getBounds(),n=t.getCenter(),o=t.getNorthEast(),r=n.lat()/57.2958,a=n.lng()/57.2958,i=o.lat()/57.2958,c=o.lng()/57.2958,s=3963*Math.acos(Math.sin(r)*Math.sin(i)+Math.cos(r)*Math.cos(i)*Math.cos(c-a));clearTimeout(u),u=setTimeout(function(){g(l.center,s)},500)})},toggleInfoWindow:function(o,r){var t,a,i;l.loading=!0,l.selected=o,(t=l.marker,a=o.center,i=p,new Promise(function(n,e){c.route({origin:t,destination:a,travelMode:"DRIVING",unitSystem:i},function(e,t){"OK"===t?n(e):reject("Directions request failed due to "+t)})})).then(function(e){var t=e.routes[0];l.directions=t.overview_path;var n=t.legs[0];n.name="...",l.infoContent=n,l.infoWindowPos=o.center,l.currentMidx==r?l.infoWinOpen=!l.infoWinOpen:(l.infoWinOpen=!0,l.currentMidx=r)}).then(function(){return t=o.center,new Promise(function(r,e){l.$refs.mapRef.$mapPromise.then(function(e){var i={gas_station:1,convenience_store:2,store:3,restaurant:4};new google.maps.places.PlacesService(e).nearbySearch({location:t,radius:500},function(e,t){var n=Object.keys(i);if(t==google.maps.places.PlacesServiceStatus.OK){var o=e.filter(function(e){return e.types.some(function(e){return n.includes(e)})});o=o.sort(function(e,t){var n=function(e,t){return e-t},o=function(e){return i[e]||1e3},r=e.types.map(o).sort(n),a=t.types.map(o).sort(n);return r[0]-a[0]}),r(0<o.length?o[0].name:e[0].name)}else reject("Places request failed due to "+t)})})});var t}).then(function(e){l.infoContent.name=e,l.loading=!1}).catch(function(e){l.infoContent.name=l.infoContent.end_address,y(e)})}}}),Vue.$gmapApiPromiseLazy().then(function(){c=new google.maps.DirectionsService,i.getSession(function(e){i.call("Get",{typeName:"User",search:{name:e.userName}},function(e){p=e[0].isMetric?google.maps.UnitSystem.METRIC:google.maps.UnitSystem.IMPERIAL},function(e){console.error(e)})})}),r=new MutationObserver(function(e){e.forEach(function(e){"class"===e.attributeName&&h(e.target.classList.contains("nightMode"))})}),n()},focus:function(e,t){if(i=e,t.device,i.mobile.exists()){var n=document.querySelector("#content.addin-content");n&&(n.style.height="height: calc(100% - 62px) !important")}r.observe(o,{attributes:!0}),h(0<document.querySelectorAll("#app.nightMode").length);i.mobile&&i.mobile.geolocation||navigator.geolocation;s=navigator.geolocation.watchPosition(function(e){var t=d(e.coords.latitude,e.coords.longitude);l.center.lat||(l.center=Object.assign({},t),g(t,l.radius)),l.marker=Object.assign({},t)},y,{enableHighAccuracy:!1,timeout:5e3,maximumAge:0})},blur:function(){navigator.geolocation.clearWatch(s),r.disconnect()}}};